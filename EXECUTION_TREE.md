# MS1T_A05.TXT 실행 순서 트리 (Execution Order Tree)

## N1 메인 프로그램 (Main Program)

```
N1 (Line 2)
├─ HKLDB(1,"MS010",1,0,0,0) - 레이저 데이터베이스 초기화
├─ HKINI(5,400.,400.,0,0,0) - 초기화 (워크피스 크기: 400x400mm)
│
├─ 파트 1 (Part 1) - N10000 (Line 5)
│  ├─ HKOST(9.9501,9.9501,0.,10001,11,0,0,0) - 파트 원점 설정
│  ├─ HKPPP - 파트 전처리 시작
│  └─ → N10001로 분기 (Subroutine call)
│
├─ 파트 2 (Part 2) - N20000 (Line 7)
│  ├─ HKOST(9.9501,119.9501,0.,10001,11,0,0,0) - 파트 원점 설정
│  ├─ HKPPP - 파트 전처리 시작
│  └─ → N10001로 분기 (Subroutine call)
│
├─ 파트 3 (Part 3) - N30000 (Line 9)
│  ├─ HKOST(9.9501,229.9501,0.,10001,11,0,0,0) - 파트 원점 설정
│  ├─ HKPPP - 파트 전처리 시작
│  └─ → N10001로 분기 (Subroutine call)
│
├─ 파트 4 (Part 4) - N40000 (Line 11)
│  ├─ HKOST(119.9501,9.9501,0.,10001,11,0,0,0) - 파트 원점 설정
│  ├─ HKPPP - 파트 전처리 시작
│  └─ → N10001로 분기 (Subroutine call)
│
├─ 파트 5 (Part 5) - N50000 (Line 13)
│  ├─ HKOST(120.0601,119.9501,0.,10001,11,0,0,0) - 파트 원점 설정
│  ├─ HKPPP - 파트 전처리 시작
│  └─ → N10001로 분기 (Subroutine call)
│
├─ N60000 HKEND(0,0,0) (Line 15) - 프로그램 종료
└─ N10 M30 (Line 16) - 프로그램 정지
```

---

## N10001 서브루틴 (Subroutine) - 파트 가공 프로그램

```
N10001 (Line 18) - 파트 가공 시작
│
├─ 컨투어 1 (Contour 1) - N10001 (Line 18-26)
│  ├─ HKSTR(0,10,53.55,36.55,0,7.,20.,0)
│  │  └─ 🔴 레이저 OFF → 🟢 레이저 ON (접근 완료 후)
│  ├─ HKPIE(0,0,0) - 피어싱 (Piercing) 🟢 레이저 ON
│  ├─ HKLEA(0,0,0) - Lead-in 시작 🟢 레이저 ON
│  ├─ HKCUT(0,0,0) - 절단 시작 🟢 레이저 ON
│  ├─ G3 X46.55 Y36.55 I-3.5 J0. (원호 절단) 🟢
│  ├─ G1 X46.55 Y23.55 (직선 절단) 🟢
│  ├─ G3 X53.55 Y23.55 I3.5 J0. (원호 절단) 🟢
│  ├─ G1 X53.55 Y30.05 (직선 절단) 🟢
│  └─ HKSTO(1,53.55,36.55,0,0,0,0,0)
│     └─ 🟢 레이저 ON → 🔴 레이저 OFF
│
├─ 컨투어 2 (Contour 2) - N10002 (Line 27-35)
│  ├─ HKSTR(0,10,40.05,50.05,0,20.,7.,0)
│  │  └─ 🔴 레이저 OFF → 🟢 레이저 ON
│  ├─ HKPIE(0,0,0) 🟢
│  ├─ HKLEA(0,0,0) 🟢
│  ├─ HKCUT(0,0,0) 🟢
│  ├─ G3 X36.55 Y53.55 I-3.5 J0. 🟢
│  ├─ G1 X23.55 Y53.55 🟢
│  ├─ G3 X23.55 Y46.55 I0. J-3.5 🟢
│  ├─ G1 X36.55 Y46.55 🟢
│  └─ HKSTO(3,40.05,50.05,0.,3.5,0,0,0)
│     └─ 🟢 → 🔴 레이저 OFF
│
├─ 컨투어 3 (Contour 3) - N10003 (Line 36-44)
│  ├─ HKSTR(1,1,74.4754,74.9877,0,9.9,9.9,0)
│  │  └─ 🔴 → 🟢 레이저 ON
│  ├─ HKPIE(0,0,0) 🟢
│  ├─ HKLEA(1,75.4716,74.9005,0,0,0,0,0) 🟢
│  ├─ HKCUT(0,0,0) 🟢
│  ├─ G1 X79.4564 Y74.5519 🟢
│  ├─ G3 X80. Y75.05 I0.0436 J0.4981 🟢
│  ├─ ;HKLEADEND (주석)
│  ├─ G3 X70.1 Y75.05 I-4.95 J0. 🟢
│  └─ HKSTO(3,80.,75.05,4.95,0.,0,0,0)
│     └─ 🟢 → 🔴 레이저 OFF
│
├─ 컨투어 4 (Contour 4) - N10004 (Line 45-56)
│  ├─ HKSTR(1,1,24.9877,73.4077,0,24.8268,21.5006,0)
│  │  └─ 🔴 → 🟢 레이저 ON
│  ├─ HKPIE(0,0,0) 🟢
│  ├─ HKLEA(1,24.9005,72.4115,0,0,0,0,0) 🟢
│  ├─ HKCUT(0,0,0) 🟢
│  ├─ G1 X24.5519 Y68.4267 🟢
│  ├─ G3 X25.05 Y67.8831 I0.4981 J-0.0436 🟢
│  ├─ ;HKLEADEND
│  ├─ G1 X37.4634 Y67.8831 🟢
│  ├─ G1 X32.8192 Y75.9271 🟢
│  ├─ G1 X25.05 Y89.3838 🟢
│  ├─ G1 X12.6366 Y67.8831 🟢
│  └─ HKSTO(1,25.05,67.8831,0,0,0,0,0)
│     └─ 🟢 → 🔴 레이저 OFF
│
├─ 컨투어 5 (Contour 5) - N10005 (Line 57-69)
│  ├─ HKSTR(1,1,32.466,32.3778,0,24.5777,24.5777,0)
│  │  └─ 🔴 → 🟢 레이저 ON
│  ├─ HKPIE(0,0,0) 🟢
│  ├─ HKLEA(1,33.232,33.0206,0,0,0,0,0) 🟢
│  ├─ HKCUT(0,0,0) 🟢
│  ├─ G1 X36.2962 Y35.5918 🟢
│  ├─ G3 X36.3284 Y36.3284 I-0.3214 J0.383 🟢
│  ├─ ;HKLEADEND
│  ├─ G3 X31.4493 Y36.3284 I-2.4396 J-2.4396 🟢
│  ├─ G1 X13.7716 Y18.6507 🟢
│  ├─ G3 X18.6507 Y13.7716 I2.4396 J-2.4395 🟢
│  ├─ G1 X33.6589 Y28.7799 🟢
│  ├─ G1 X36.3284 Y31.4493 🟢
│  └─ HKSTO(3,36.3284,36.3284,-2.4396,2.4395,0,0,0)
│     └─ 🟢 → 🔴 레이저 OFF
│
├─ 컨투어 6 (Contour 6) - N10006 (Line 70-78)
│  ├─ HKSTR(1,1,51.9754,74.9877,0,14.9,14.9,0)
│  │  └─ 🔴 → 🟢 레이저 ON
│  ├─ HKPIE(0,0,0) 🟢
│  ├─ HKLEA(1,52.9716,74.9005,0,0,0,0,0) 🟢
│  ├─ HKCUT(0,0,0) 🟢
│  ├─ G1 X56.9564 Y74.5519 🟢
│  ├─ G3 X57.5 Y75.05 I0.0436 J0.4981 🟢
│  ├─ ;HKLEADEND
│  ├─ G3 X42.6 Y75.05 I-7.45 J0. 🟢
│  └─ HKSTO(3,57.5,75.05,7.45,0.,0,0,0)
│     └─ 🟢 → 🔴 레이저 OFF
│
├─ 컨투어 7 (Contour 7) - N10007 (Line 79-87)
│  ├─ HKSTR(1,1,50.1092,49.626,0,2.9,2.9,0)
│  │  └─ 🔴 → 🟢 레이저 ON
│  ├─ HKPIE(0,0,0) 🟢
│  ├─ HKLEA(1,50.8568,49.5606,0,0,0,0,0) 🟢
│  ├─ HKCUT(0,0,0) 🟢
│  ├─ G1 X50.9564 Y49.5519 🟢
│  ├─ G3 X51.5 Y50.05 I0.0436 J0.4981 🟢
│  ├─ ;HKLEADEND
│  ├─ G3 X48.6 Y50.05 I-1.45 J0. 🟢
│  └─ HKSTO(3,51.5,50.05,1.45,0.,0,0,0)
│     └─ 🟢 → 🔴 레이저 OFF
│
├─ 컨투어 8 (Contour 8) - N10008 (Line 88-96)
│  ├─ HKSTR(1,1,62.5966,49.7146,0,4.9,4.9,0)
│  │  └─ 🔴 → 🟢 레이저 ON
│  ├─ HKPIE(0,0,0) 🟢
│  ├─ HKLEA(1,63.5928,49.6275,0,0,0,0,0) 🟢
│  ├─ HKCUT(0,0,0) 🟢
│  ├─ G1 X64.4564 Y49.5519 🟢
│  ├─ G3 X65. Y50.05 I0.0436 J0.4981 🟢
│  ├─ ;HKLEADEND
│  ├─ G3 X60.1 Y50.05 I-2.45 J0. 🟢
│  └─ HKSTO(3,65.,50.05,2.45,0.,0,0,0)
│     └─ 🟢 → 🔴 레이저 OFF
│
├─ 컨투어 9 (Contour 9) - N10009 (Line 97-109)
│  ├─ HKSTR(1,1,82.3778,17.634,0,24.5777,24.5777,0)
│  │  └─ 🔴 → 🟢 레이저 ON
│  ├─ HKPIE(0,0,0) 🟢
│  ├─ HKLEA(1,83.0206,16.868,0,0,0,0,0) 🟢
│  ├─ HKCUT(0,0,0) 🟢
│  ├─ G1 X85.5918 Y13.8038 🟢
│  ├─ G3 X86.3284 Y13.7716 I0.383 J0.3214 🟢
│  ├─ ;HKLEADEND
│  ├─ G3 X86.3284 Y18.6507 I-2.4396 J2.4396 🟢
│  ├─ G1 X83.6589 Y21.3201 🟢
│  ├─ G1 X68.6507 Y36.3284 🟢
│  ├─ G3 X63.7716 Y31.4493 I-2.4395 J-2.4396 🟢
│  ├─ G1 X81.4493 Y13.7716 🟢
│  └─ HKSTO(3,86.3284,13.7716,2.4395,2.4396,0,0,0)
│     └─ 🟢 → 🔴 레이저 OFF
│
├─ 컨투어 10 (Contour 10) - N10010 (Line 110-118)
│  ├─ HKSTR(1,1,75.0958,49.8022,0,6.9,6.9,0)
│  │  └─ 🔴 → 🟢 레이저 ON
│  ├─ HKPIE(0,0,0) 🟢
│  ├─ HKLEA(1,76.092,49.715,0,0,0,0,0) 🟢
│  ├─ HKCUT(0,0,0) 🟢
│  ├─ G1 X77.9564 Y49.5519 🟢
│  ├─ G3 X78.5 Y50.05 I0.0436 J0.4981 🟢
│  ├─ ;HKLEADEND
│  ├─ G3 X71.6 Y50.05 I-3.45 J0. 🟢
│  └─ HKSTO(3,78.5,50.05,3.45,0.,0,0,0)
│     └─ 🟢 → 🔴 레이저 OFF
│
├─ 컨투어 11 (Contour 11) - N10011 (Line 119-144) - 외곽선
│  ├─ HKSTR(1,1,100.1,105.1,0,100.1,105.1,0)
│  │  └─ 🔴 → 🟢 레이저 ON
│  ├─ HKPIE(0,0,0) 🟢
│  ├─ HKLEA(1,100.1,104.1,0,0,0,0,0) 🟢
│  ├─ HKCUT(0,0,0) 🟢
│  ├─ G1 X100.1 Y100.1 🟢
│  ├─ ;HKLEADEND
│  ├─ G1 X100.1 Y75.0293 🟢
│  ├─ G1 X90.1 Y65.0293 🟢
│  ├─ G1 X90.1 Y35.0707 🟢
│  ├─ G1 X100.1 Y25.0707 🟢
│  ├─ G1 X100.1 Y0. 🟢
│  ├─ G1 X75.0293 Y0. 🟢
│  ├─ G1 X65.0293 Y10. 🟢
│  ├─ G1 X35.0707 Y10. 🟢
│  ├─ G1 X25.0707 Y0. 🟢
│  ├─ G1 X0. Y0. 🟢
│  ├─ G1 X0. Y25.0707 🟢
│  ├─ G1 X10. Y35.0707 🟢
│  ├─ G1 X10. Y65.0293 🟢
│  ├─ G1 X0. Y75.0293 🟢
│  ├─ G1 X0. Y100.1 🟢
│  ├─ G1 X25.0707 Y100.1 🟢
│  ├─ G1 X35.0707 Y90.1 🟢
│  ├─ G1 X65.0293 Y90.1 🟢
│  ├─ G1 X75.0293 Y100.1 🟢
│  └─ HKSTO(1,100.1,100.1,0,0,0,0,0)
│     └─ 🟢 → 🔴 레이저 OFF
│
└─ N10012 HKPED(0,0,0) (Line 145) - 파트 종료
   └─ 🔴 레이저 OFF (파트 완료)
```

---

## 레이저 상태 변화 타이밍 요약

### 레이저 ON 시점 🟢
1. **HKSTR** - 접근 경로 완료 후 피어싱 위치 도달 시
2. **HKPIE** - 피어싱 시작 (천공)
3. **HKLEA** - Lead-in 경로 시작
4. **HKCUT** - 절단 경로 시작
5. **G1/G2/G3** - 모든 절단 경로 이동 (레이저 ON 유지)

### 레이저 OFF 시점 🔴
1. **HKSTO** - 컨투어 절단 완료
2. **HKPED** - 파트 가공 완료
3. **HKEND** - 전체 프로그램 종료

### 접근 경로 (Approach Path)
- **HKSTR 직후 ~ 피어싱 위치**: 레이저 OFF 상태로 이동
- 이동 속도는 일반적으로 빠름 (rapid move)

---

## 실행 흐름 (Execution Flow)

```
시작 → N1 → HKLDB/HKINI (초기화)
  ↓
N10000 → HKOST → HKPPP → N10001 (파트1 가공)
  ↓
N20000 → HKOST → HKPPP → N10001 (파트2 가공)
  ↓
N30000 → HKOST → HKPPP → N10001 (파트3 가공)
  ↓
N40000 → HKOST → HKPPP → N10001 (파트4 가공)
  ↓
N50000 → HKOST → HKPPP → N10001 (파트5 가공)
  ↓
N60000 → HKEND → M30 (종료)
```

### 각 파트는 N10001 서브루틴 호출
- N10001 ~ N10012: 11개 컨투어 순차 가공
- 각 컨투어: HKSTR → HKPIE → HKLEA → HKCUT → (절단경로) → HKSTO
- 파트 완료: HKPED

---

## 통계 (Statistics)

- **전체 파트 수**: 5개 (동일한 형상 5번 반복)
- **각 파트당 컨투어 수**: 11개
- **전체 컨투어 수**: 5 × 11 = 55개
- **레이저 ON/OFF 사이클**: 컨투어당 1회 = 55회
- **워크피스 크기**: 400mm × 400mm
- **파트 크기**: 약 100mm × 100mm

---

## 참고사항

1. **HKPPP** 명령어는 파트 전처리를 의미하며, 실제 서브루틴(N10001) 호출을 트리거합니다.

2. **HKSTR**의 첫 번째 매개변수:
   - `0`: Lead-in 없음
   - `1`: Lead-in 있음

3. **HKSTO**의 첫 번째 매개변수:
   - `1`: 직선 종료
   - `3`: 원호 종료

4. **HKLEADEND** 주석은 Lead-in 경로 종료 지점을 표시합니다.

5. 모든 컨투어는 **피어싱 → Lead-in → 절단 → 종료** 순서를 따릅니다.
